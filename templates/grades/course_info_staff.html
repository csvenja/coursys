{% extends "base.html" %}

{% block title %}{{ course.subject }} {{ course.number }} Course Information{% endblock %}
{% block h1 %}{{ course.subject }} {{ course.number }} Course Information{% endblock %}

{% block headextra %}
<script type="text/javascript">
//<![CDATA[
    /*store activity ids*/	
	var act_ids = new Array();
	
    $(document).ready(function() {
	var oTable = $('#activities').dataTable({
		"bJQueryUI": true,
		"bSort": true,
		"bPaginate": false,
		"bFilter": false,
		"bInfo": false,
		"aaSorting": [[0, "asc"]],
		"fnDrawCallback": enable_disable_ordering,
		"aoColumns": [
		    {"sType": "numnull"},
		    null,
		    null,
		    {"sType": "numnull"},
		    null,
		    {"sType": "numnull"},
		    null,
		    null,
		],
	});
	
	// activity reordering
	{%for info in activities_info%}
		act_ids[{{forloop.counter}}-1] = "{{info.activity.id}}";
	{%endfor%}
	
	for(var r = 1; r <= {{activities_info|length}}; r++)
	{
	    /* when javascript is enabled, use ajax call to reorder activity */
	    $('#arrow' + r + ' ' + 'a.arrow_up').attr('href', 'javascript: return false;');
	    $('#arrow' + r + ' ' + 'a.arrow_down').attr('href', 'javascript: return false;');
	    
	   /* attach position info to the arrow td */
	    $('#arrow' + r).data('pos', r-1);
	}			
	
	$('.arrow_up').click(function(){			
		 var p = $(this).parent();
		 var i = p.data('pos');			 
		 /* post request */
		 if(i > 0){
			$.post("{% url "grades.views.reorder_activity" course_slug=course.slug %}",
				{'id_up': act_ids[i], 'id_down': act_ids[i-1], 'csrfmiddlewaretoken': "{{csrf_token}}"}, 
				function(data){ /* request success callback: swap rows */					 				
					 /* swap the content of the current row and the previous row(except for the first column) */				
					 var row = oTable.fnGetNodes(i);
					 var pre_row = oTable.fnGetNodes(i-1);
					 var content = oTable.fnGetData(row);
					 var pre_content = oTable.fnGetData(pre_row);
					 var temp;
					 for (var col=1, len = content.length ; col<len ; col++ )
					 {  
					    temp = content[col];
						oTable.fnUpdate(pre_content[col], i, col);
						oTable.fnUpdate(temp, i-1, col); 
					 }
					 /* swap the order of the two ids as well */
					 temp = act_ids[i];
					 act_ids[i] = act_ids[i-1];
					 act_ids[i-1] = temp;			 				 
					 
					 oTable.fnDraw();			
				 
				});
			}
	  });
	 
	$('.arrow_down').click(function(){
		 var p = $(this).parent();
		 var i = p.data('pos');
		 if(i < {{activities_info|length}}-1){
		 /* post request */
			$.post("{% url "grades.views.reorder_activity" course_slug=course.slug %}",		  	 
				{'id_up': act_ids[i+1], 'id_down': act_ids[i], 'csrfmiddlewaretoken': "{{csrf_token}}"},
				function(data){ /* request success callback: swap rows */  		 	 
				     /* swap the content of the current row and the next row(except for the first column) */
					 var row = oTable.fnGetNodes(i);
					 var next_row = oTable.fnGetNodes(i+1);
					 var content = oTable.fnGetData(row);
					 var next_content = oTable.fnGetData(next_row);					
					 var temp;
					 for (var col=1, len = content.length ; col<len ; col++ )
					 {  
					    temp = content[col];
						oTable.fnUpdate(next_content[col], i, col);
						oTable.fnUpdate(temp, i+1, col); 
					 }
					 /* swap the order of the two ids as well */
					 temp = act_ids[i];
					 act_ids[i] = act_ids[i+1];
					 act_ids[i+1] = temp;	
									 
					 oTable.fnDraw();
				});		 
			}
	  });
    });
//]]>
</script>
{% endblock %}


{% block subbreadcrumbs %}<li>{{ course.name }} ({{course.semester.label}})</li>{% endblock %}


{% block actions %}
<div id="actions">
    <h2>Actions</h2>
    <ul class="fa-ul">
	<li><a href="{% url "grades.views.course_config" course_slug=course.slug %}"><i class="fa fa-li fa-wrench"></i> Edit Course Setup</a></li>
        <li><a href="{% url "grades.views.activity_choice" course_slug=course.slug %}"><i class="fa fa-li fa-plus"></i>Add Activity</a></li>
        {% if course.discussion %}
        <li><a href="{% url "discuss.views.discussion_index" course_slug=course.slug %}"><i class="fa fa-li fa-comment-o"></i> Course Discussion
        	{% if discussion_activity %}<i class="fa fa-comments infomessage"></i>{% endif %}
        	</a></li>
        {% endif %}
        <li class="newsec"><a href="{% url "grades.views.class_list" course_slug=course.slug %}"><i class="fa fa-li fa-list"></i>Display Class List</a></li>
        <li><a href="{% url "grades.views.all_grades" course_slug=course.slug %}"><i class="fa fa-li fa-table"></i>Display All Grades</a></li>
        <li><a href="{% url "grades.views.student_search" course_slug=course.slug %}"><i class="fa fa-li fa-search"></i>Student Search</a></li>
	<li class="newsec"><a href="{% url "grades.views.new_message" course_slug=course.slug %}"><i class="fa fa-li fa-bullhorn"></i>Create News Item</a></li>
	{% if any_group %}<li><a href="{% url "groups.views.groupmanage" course_slug=course.slug %}"><i class="fa fa-li fa-group"></i>Manage Groups</a></li>{% endif %}
        <li><a href="{% url "discipline.views.index" course_slug=course.slug %}"><i class="fa fa-li fa-gavel"></i>Dishonesty Cases</a></li>
        <li><a href="{% url "pages.views.index_page" course_slug=course.slug %}"><i class="fa fa-li fa-edit"></i>Course Pages</a></li>
    {% if member.role == "TA" %}
        <li class="newsec"><a href="{% url "ta.views.view_tug" course_slug=course.slug userid=user.username %}"><i class="fa fa-li fa-clock-o"></i>Time Use Guideline</a></li>
    {% endif %}
    </ul>
</div>
{% endblock %}
{% block content %}
<div class="table_container">
    <table class="info">
        <tbody>
            <tr>
                <th scope="row">Course Number</th>
                <td>{{ course.subject }} {{ course.number }} {{ course.section }}, {{ course.semester.label }} ({{ course.semester.name }})</td>
            </tr>
            <tr>
                <th scope="row">Title</th>
                <td>{{ course.title }}</td>
            </tr>
            <tr>
                <th scope="row">Instructor(s)</th>
                <td>{% for instructor in course.instructors %}
                    {{ instructor.name_with_pref }} &lt;<a href="mailto:{{ instructor.email }}">{{ instructor.email }}</a>&gt;{% if not forloop.last %}, {% endif %}
                    {% endfor %}</td>
            </tr>
            <tr>
                <th scope="row">TA(s)</th>
                <td>
                {% if course.config.taemail %}
                <a href="mailto:{{ course.config.taemail }}">{{ course.config.taemail }}</a>
                ({% for ta in course.tas %}{{ ta.name_with_pref }} &lt;<a href="mailto:{{ ta.email }}">{{ ta.email }}</a>&gt;{% if not forloop.last %}, {% endif %}{% endfor %})
                {% else %}
                {% for ta in course.tas %}
                  {{ ta.name }} &lt;<a href="mailto:{{ ta.email }}">{{ ta.email }}</a>&gt;{% if not forloop.last %}, {% endif %}
                {% endfor %}
                {% endif %}
                </td>
            </tr>
            <tr>
                <th scope="row">Number of Students</th>
                <td>{{ course.student_count }}</td>
            </tr>
            <tr>
                <th scope="row">Course home page</th>
                <td>{% if course.config.url %}{{ course.config.url|urlize }}{% endif %}</td>
            </tr>
        </tbody>
    </table>
</div>

    <h2 id="act">Course Activities</h2>
    {% if activities_info %}
    <table id="activities">
        <thead>
            <tr>
                <th scope="col">Order</th>
                <th scope="col">Activity</th>
                <th scope="col">Group?</th>
                <th scope="col">Max<span class="wideonly"> Grade</span></th>
                <th scope="col"><span class="wideonly">Grade </span>Type</th>
                <th scope="col"><span class="wideonly">Percentage</span><span class="narrowonly">%</span></th>
                <th scope="col">Status</th>
                <th scope="col">Due<span class="wideonly"> Date</span></th>
            </tr>
        </thead>
        <tbody>
            {% for activity_info in activities_info %}
            {% with activity_info.activity as activity %}
            <tr>
                <td id="arrow{{forloop.counter}}">
                    <span class="sort">{{ activity.position }}</span>
                    {% if not forloop.first %}
		    <a class="arrow_up" href="{% url "grades.views.course_info" course_slug=course.slug %}?order=up&amp;act={{ activity.slug }}">  
		    <i class="fa fa-arrow-up"></i>
		    </a>
		    {% endif %}
		    {% if not forloop.last %}
		    <a class="arrow_down" href="{% url "grades.views.course_info" course_slug=course.slug %}?order=down&amp;act={{ activity.slug }}">
			<i class="fa fa-arrow-down"></i>
		    </a>
		    {% endif %}
                </td>
                <td scope="row">
                <a href="{% url "grades.views.activity_info" course_slug=course.slug activity_slug=activity.slug %}">{{ activity.name }}</a>
                </td>
                
                <td>{% if activity.group %}group{% else %}individual{% endif %}</td>
                
                {% ifnotequal activity.max_grade None %}
                <td>{{ activity.max_grade }}</td>
                {% else %}
                <td>&mdash;</td>
                {% endifnotequal %}
		<td>
		    {% if activity.is_numeric %}
		    	{% if activity.is_calculated %}
				Calculated Numeric
		    	{% else %}
		    		Numeric
		    	{% endif %}
		    {% else %}
		    	{% if activity.is_calculated %}
				Calculated Letter
		    	{% else %}
		    		Letter
		    	{% endif %}
		    {% endif %}
		</td>
		{% ifnotequal activity.percent None %}
                <td>{{ activity.percent }}%</td>
		{% else %}
                <td>&mdash;</td>
                {% endifnotequal %}
                <td class="{{activity.status|lower}}">{{ activity.get_status_display }}</td>
                <td class="{{activity.due_class}}"><span class="sort">{{ activity.due_date.isoformat }}</span>{{ activity.due_date }}</td>
            </tr>
            {% endwith %}
          {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="empty">No activities defined. You can <a href="{% url "grades.views.activity_choice" course_slug=course.slug %}">add an activity</a> to get started.</p>
    {% endif %}
{% if activities_info %}
<p>Percent total: {{total_percent}}%</p>
{% endif %}
{% endblock %}
